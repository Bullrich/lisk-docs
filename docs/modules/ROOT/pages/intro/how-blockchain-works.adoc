= How blockchain works
Chris Braithwaite <christopher.braithwaite@lightcurve.io> Mona Bärenfänger <mona@lightcurve.io>

:description: The How blockchain works page describes in more detail the functionalities of a blockchain.

:toc: preamble
:idprefix:
:idseparator: -
:imagesdir: ../../assets/images
//:experimental::toc:
:page-previous: /root/intro/what-is-blockchain.html
:page-previous-title: What is blockchain
:page-next: /root/intro/lisk-products.html
:page-next-title: Lisk products

// :url_hello: build-blockchain/create-blockchain-app.adoc


=== Overview
As described on the previous page from a high-level perspective blockchain is basically a 'digital ledger' which has many functionalities and use cases.
It can also be thought of as a digital methodology to store data, whereby the data is encapsulated in blocks, and once the blocks are chained together they cannot be changed or altered, thus making them immutable. +
Once a block of data is added to the blockchain it will remain publicly viewable to anyone at anytime. This is a highly beneficial system as it enables permanent records to be kept, enabling the storage of almost any type of record. For example, it could be virtually anything such as medical records, financial transactions, property rights, etc. +

To start to break down how the blockchain works, and before we delve into the detailed contents of a block, firstly we need to understand how the blocks are linked together, this is accomplished by using cryptography. Therefore, each block contains a cryptographic hash of the previous block, the transaction data,  and a timestamp. This will be explained in more detail further in this section. +
As previously mentioned once created, the blocks are immutable and cannot be changed retroactively. The only way this could be achieved would be by altering the subsequential blocks, which would require the consensus of the entire network.

// image::intro/blockchain-architecture.png[]



=== Key characteristics of blockchain

There are four core characteristics attributed to the blockchain which are covered below:

* Decentralization – The contents of each block in the blockchain can be accessed by any node on the network, as they are essentially network copies present on all participating nodes. Therefore, there is no central entity that holds each block in the chain, so this creates decentralization. +

* Consensus Driven – A consensus model independently verifies each block on the blockchain, and provides certain rules for validating a block, which may utilise key resources such as computing power, in order to demonstrate that this has been accomplished. For example, with regard to Bitcoin this is known as the mining process. +
There are different types of consensus models which will be covered further in this section, however suffice to say that a consensus model is able to function independently, and does not require any form of central authority.

* Immutability – A blockchain can be considered as a permanent, unchangeable, and irreversible record of transactions. Hence, once a block is created and added to the blockchain it ensures the transaction is completely trustable.

* Transparency – A blockchain by its very nature provides total open transparency. A full transaction history  can be viewed by any party as it is in effect an open file. Therefore, another highly beneficial advantage is that a blockchain creates provenance, as all transactions can be easily audited from the first to the last entry.


=== Consensus mechanisms

It is important to understand consensus within the blockchain ecosystem. Basically, a consensus mechanism is a methodology deployed by nodes to agree on, and validate the data content of a block before it becomes part of a blockchain. The block containing this data is then distributed to all the nodes within the network. The consensus algorithm is responsible for ensuring that only 1 copy of the data encapsulated in each block exists within each node.

Various consensus mechanisms exist today, however the 4 main mechanisms that are widely used consist of the Proof-of-Work, Proof-of-Stake, Delegated-Proof-of-Stake, and Byzantine-Fault-Tolerance mechanisms, which are explained below:

=== Consensus algorithms

To put it in an nutshell, a consensus algorithm can be thought of as a necessary procedure which results in ensuring all peers of a blockchain network come to a common agreement of the current state of the network.


=== Proof-of-Work (PoW)
Proof of Work is probably the most well-known and established consensus mechanism, as it is utilized by Bitcoin. However, when compared to the other consensus mechanisms, it is somewhat inefficient as it requires a high amount of energy and processing power to reach a consensus, thus being rather cumbersome and expensive to operate. Basically to validate transactions it requires the nodes to solve an arbitrary mathematical problem or complex equations, which prevents the network being hacked, and also provides a high level of security. It is also widely used for mining cryptocurrencies and minting new tokens.

=== Proof-of-Stake (PoS)
To explain PoS briefly, it allows the users to stake an asset/token which in turn opens up the possibility to be chosen as a validator of a new block, which then allows transaction fees, or newly minted tokens to be collected from the block as a reward. Staking is defined as an amount of tokens/assets that are held by the node. The proof-of-stake-mechanism uses a random algorithm for consensus building and eliminates the need for complex mathematical calculations, hence reducing the overall computing power and enery required. Alternatively, the nodes that hold the most tokens/assets have the power to validate the transactions, which in turn results in this node receiving a reward, usually in newly minted tokens.


=== Delegated-Proof-of-Stake (DPoS)

DPoS works in a similar fashion to PoS, however one of the key advantages is that it utilizes a delegation and voting mechanism, which in turn incentivizes the users to use their staked collateral to secure the network. To allow this mechanism to be both efficient and effective at performing transaction validations, various different components of delegated proof of stake exist. Ultimately, the DPoS is considered the most advantageous mechanism here, as it was designed to negate most of the limitations that exist with PoW and PoS. This consensus algorithm used in DPoS utilizes a unique election system that is able to select nodes which are able to perform block verification.
In this system, generally  delegates are voted in based upon their reputation. Each user who holds a minimum of one token/coin with the DPoS blockchain has the ability to vote specifically for the nodes that they want to perform the transaction validations.
This is the consensus mechanism used by Lisk, and hence every Lisk holder is able to vote for delegates, and dependent on these votes, certain delegates are allowed to add blocks to the blockchain in a specific order. The delegates are actually normal Lisk accounts that have performed a delegate registration transaction. +
The whole process can be considered as the most democratic method of voting, as it does not rest on the users that possess the highest amount of tokens, as just because a particular user has many tokens, that does not authorize this user to validate and confirm transactions. All the users that maintain tokens in their accounts are able to select a group of delegates to perform this task. Furthermore, the DPoS has the advantage of being able to execute transactions and verifications much faster, which results in higher scalability.

=== Byzantine-Fault-Tolerance (BFT)

The BFT mechanism was designed in a manner whereby it is able to tolerate failures in the network, coupled with being able to withstand malicious attacks and corrupted data. In a nutshell the BFT mechanism ensures that the same guaranteed data is received by every node present in the network. In essence, it allows consensus to be reached regardless if some of the nodes fail.

Firstly, there are 3 key features whereby BFT is able to improve the blockchain, and they are listed below:

1. Safety: If 2 conflicting blocks occur on the network, then assuming two-thirds of the active delegates adhere honestly to the protocol, then these 2 conflicting blocks will not be finalized on the blockchain.

2. Liveness: New blocks can still be finalized on the network, even in the case whereby one third of the active delegates are offline.

3. Accountability: In the case whereby the protocol is violated by the delegate, they will be held responsible for this.
 The key requirements for BFT must be accomplished by the nodes within a blockchain network, therefore, it is imperative they are deterministic and must begin with the same state for practical BFT.



The process of being able  to tolerate an amount of  Byzantine process failures or crashes, whilst ensuring the network continues to function is defined as Byzantine fault tolerant (BFT).
To achieve BFT consensus the following requirements must be met:

1. Termination: An output is decided by every non-faulty process
2. Agreement: The same output is decided by every non-faulty process
3. Validitiy: Every process starts with the same input
4. Integrity: The consensus value and all non-faulty process decisions achieved in point 2 above, need to have been put forward by some non-faulty process





=== Peer-2-Peer networks

=== Cryptography

=== State machine

// To secure its blockchain and keep its distributed network of computers in sync, Lisk uses a consensus system called delegated proof-of-stake (DPoS). DPoS leverages a real-time voting system to determine which computers running the software can create the next block on the Lisk blockchain.