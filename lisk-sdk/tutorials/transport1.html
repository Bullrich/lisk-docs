<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transport Tutorial Part 1: Track a packet on the blockchain :: Docs</title>
    <link rel="canonical" href="https://lisk.io/documentation/lisk-sdk/tutorials/transport1.html">
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<!--
    <link href="https://unpkg.com/primer/build/build.css" rel="stylesheet">
-->
<link rel="icon" href="/sites/default/files/favicons/favicon-32x32.png" type="image/png">
  </head>
  <body class="article">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-NKNKGHL');</script>
<!-- End Google Tag Manager -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NKNKGHL"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<header class="header">
  <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-brand">
          <a href="https://lisk.io/documentation" class="lisk-logo"></a>
          <span  class="nav-brand__name-area">
              <strong class="nav-brand__name-area__title">Docs</strong>
          </span>
          <button class="navbar-burger" data-target="topbar-nav">
            <span></span>
            <span></span>
            <span></span>
          </button>
        </div>
        <div id="topbar-nav" class="navbar-menu">
          <div class="navbar-end">
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Docs</a>
              <div class="navbar-dropdown">
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/">Lisk SDK</a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-core/">Lisk Core</a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Tutorials</a>
              <div class="navbar-dropdown">
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/tutorials/hello-world.html"><strong>Hello World</strong>: Custom transactions 101</a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/tutorials/cashback.html"><strong>Cashback</strong>: How to extend from another transaction type.</a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/tutorials/transport.html"><strong>Transport</strong>: How to connect IoT devices to the network</a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">API</a>
              <div class="navbar-dropdown">
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-core/api.html">Testnet</a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-core/api-mainnet.html">Mainnet</a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Reference</a>
              <div class="navbar-dropdown">
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/lisk-elements/packages.html">Lisk Elements</a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/lisk-commander/user-guide.html">Lisk Commander</a>
                <a class="navbar-item" href="https://lisk.io/documentation/lisk-sdk/lisk-framework">Lisk Framework</a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Ressources</a>
              <div class="navbar-dropdown">
                <a class="navbar-item" href="https://lisk.io/roadmap">Roadmap</a>
                <a class="navbar-item" href="https://lisk.io/lisk-builders">Lisk Builders Program</a>
                <a class="navbar-item" href="https://lisk.io/community">Community</a>
                <a class="navbar-item" href="https://lisk.io/apps">App List</a>
              </div>
            </div>
            <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Github</a>
              <div class="navbar-dropdown">
                <a class="navbar-item" target="_blank" href="https://github.com/LiskHQ/lisk-sdk">Lisk SDK</a>
                <a class="navbar-item" target="_blank" href="https://github.com/LiskHQ/lisk-core">Lisk Core</a>
                <a class="navbar-item" target="_blank" href="https://github.com/LiskHQ/lisk-desktop">Lisk Desktop</a>
                <a class="navbar-item" target="_blank" href="https://github.com/LiskHQ/lisk-mobile">Lisk Mobile</a>
                <a class="navbar-item" target="_blank" href="https://github.com/LiskHQ/lisk-sdk-examples">Example Applications</a>
              </div>
            </div>
            <div class="navbar-item button-back">
              <span class="control">
                <a class="button is-primary" href="https://lisk.io">Back to lisk.io</a>
              </span>
            </div>
          </div>
        </div>
      </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="lisk-sdk" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Lisk SDK</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html"><strong>Overview</strong></a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../setup.html">Setup</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../configuration.html">Configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../customize.html">Customization</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><strong>Tutorials</strong></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="hello-world.html">Custom transaction 101 (Hello World)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cashback.html">How to extend from an existing transaction type (Cashback)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="transport.html">How to connect IoT devices to the blockchain (Transport)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="transport0.html">Part 0: Installation &amp; Setup</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="transport1.html">Part 1: Tracking a packet on the blockchain</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="transport2.html">Part 2: A simple supply chain management system</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="transport3.html">Part 3: Next steps</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><strong>Lisk Commander</strong></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../lisk-commander/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../lisk-commander/user-guide.html">User Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-commander/user-guide/commands.html">Command Reference</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-commander/user-guide/lisk-core.html">Lisk Core Commands</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-commander/user-guide/sensitive-inputs.html">Sensitive inputs</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><strong>Lisk Elements</strong></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../lisk-elements/index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../lisk-elements/packages.html">Packages</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-elements/packages/api-client.html">API Client</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-elements/packages/client.html">Client</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-elements/packages/constants.html">Constants</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-elements/packages/cryptography.html">Cryptography</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-elements/packages/passphrase.html">Passphrase</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../lisk-elements/packages/transactions.html">Transactions</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text"><strong>Lisk Framework</strong></span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../lisk-framework/index.html">Overview</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Lisk SDK</span>
    <span class="version">2.3.6 (latest)</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Lisk Core</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../lisk-core/index.html">2.1.3 (latest)</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Lisk SDK</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">2.3.6 (latest)</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Lisk SDK</a></li>
    <li><strong>Tutorials</strong></li>
    <li><a href="transport.html">How to connect IoT devices to the blockchain (Transport)</a></li>
    <li><a href="transport1.html">Part 1: Tracking a packet on the blockchain</a></li>
  </ul>
</nav>
<button class="toc-toggle"></button>
  <div class="edit-this-page"><a href="https://github.com/LiskHQ/lisk-docs/edit/docs-sdk/modules/ROOT/pages/tutorials/transport1.adoc">Edit this Page</a></div>
  </div>
<article class="doc">
<h1 class="page">Transport Tutorial Part 1: Track a packet on the blockchain</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The goal of this part is to implement a simple application that tracks sensor measurements on the blockchain.
That means, once the IoT application will be started, it will immediately send an <code>LightAlarmTransaction</code> to the network, whenever the sensor detects light.</p>
</div>
<div class="paragraph">
<p>You will learn here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to implement the <code>LightAlarmTransaction</code></p>
</li>
<li>
<p>How to register the new transaction type with the node application</p>
</li>
<li>
<p>How to create the IoT script, and how to put it on the Raspberry Pi</p>
</li>
<li>
<p>How to use the client app to initialize the packet account and to track the alarm transactions in the network</p>
</li>
</ul>
</div>
<div class="sidebarblock">
<div class="content">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/transactions/solutions/light-alarm.js">You can always checkout the solutions at /transactions/solutions</a> for the custom transaction types.</p>
</div>
<div class="paragraph">
<p>You can also require the solutions directly in your app, just change</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const LightAlarmTransaction = require('../transactions/light-alarm');</code></pre>
</div>
</div>
<div class="paragraph">
<p>To</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const LightAlarmTransaction = require('../transactions/solutions/light-alarm');</code></pre>
</div>
</div>
<div class="paragraph">
<p>But let&#8217;s try not to cheat too much ;-)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_architecture"><a class="anchor" href="#_project_architecture"></a>Project Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Three different kind of applications need to be developed, to create the decentralized supply chain system:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">A node application</dt>
<dd>
<p>which accepts the application-specific transaction types.
This application needs to be installed on different independent nodes and will setup and maintain the blockchain which is used to store the data about the packets, carrier and users.</p>
</dd>
<dt class="hdlist1">A client application</dt>
<dd>
<p>which is displaying information from the blockchain to the user.
It needs a frontend, which should be listing at least a list of packetIDs, the carrier, sender, recipient, and a status field (<code>pending | ongoing | alarm | success | fail</code>).
It should also provide an easy way to create and send the different transaction types to the network.</p>
</dd>
<dt class="hdlist1">An IoT application</dt>
<dd>
<p>which is stored on a microcontroller/raspberry pi. This application will track that the packet is not manipulated during the delivery.
To do this, certain sensors will be connected to it, that track information like light, temperature and/or humidity inside of the packet.
If something unexpected is detected by the IoT app, it will create a transaction object, sign it, and send it to the network.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The basic file structure looks as following (contents of <code>lisk-sdk-examples/transport</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── README.adoc
├── Workshop.adoc
├── client                                          <i class="conum" data-value="1"></i><b>(1)</b>
│   ├── accounts.json
│   ├── app.js
│   ├── package.json
│   ├── scripts
│   └── views
├── iot                                             <i class="conum" data-value="2"></i><b>(2)</b>
│   ├── README.md
│   ├── lisk_rpi_ldr_and_temperature_sensors_wiring.png
│   ├── light_alarm
│   │   ├── package.json
│   │   └── index.js
├── node                                            <i class="conum" data-value="3"></i><b>(3)</b>
│   ├── index.js
│   └── package.json
└── transactions                                    <i class="conum" data-value="4"></i><b>(4)</b>
    ├── finish-transport.js
    ├── light-alarm.js
    ├── register-packet.js
    └── start-transport.js</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Contains the code for the <a href="#_project_architecture">client application</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Contains the code for the <a href="#_project_architecture">IoT application</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Contains the code for the <a href="#_project_architecture">node application</a></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Contains the custom transactions, that are used by the node and client app.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_1_implement_the_lightalarm_transaction"><a class="anchor" href="#_1_1_implement_the_lightalarm_transaction"></a>1.1 Implement the LightAlarm Transaction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the very simple version of the packet tracking, only one custom transaction type needs to be implemented: the <code>LightAlarmTransaction</code>.
This transaction will be sent by the IoT device inside of the packet when it detects anomalies with its connected photoresistor (light detection).</p>
</div>
<div class="paragraph">
<p>The only thing you need to implement in this step yourself is the <code>validateAsset</code> function. For more details how to do this, check the <a href="#_task_implement_validateasset">explanation below</a>.
The code you see below represents the current state for which you&#8217;ll have to implement the <code>validateAsset()</code> function.</p>
</div>
<div class="listingblock">
<div class="title">Contents of <code>/transactions/light-alarm.js</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const {
    BaseTransaction,
    TransactionError,
} = require('@liskhq/lisk-transactions');

/**
 * Send light alarm transaction when the packet has been opened (accepts timestamp).
 * Self-signed by packet.
 * The `LightAlarmTransaction` is extended from the `BaseTransaction` interface.
 */
class LightAlarmTransaction extends BaseTransaction {

    /* Static property that defines the transaction `type` (has to be unique in the network). */
    static get TYPE () {
        return 23;
    }

    /* The transaction `fee`. This needs to be paid by the sender when posting the transaction to the network.
       It is set to `0`, so the packet doesn't need any funds to send an alarm transaction. */
    static get FEE () {
        return '0';
    };

    /* Data from the packet account is cached from the databse. */
    async prepare(store) {
        await store.account.cache([
            {
                address: this.senderId,
            }
        ]);
    }

    /* Static checks for presence and correct datatype of `timestamp`, which holds the timestamp of when the alarm was triggered. */
    validateAsset() {
        const errors = [];
        /*
        Implement your own logic here.
        Static checks for presence of `timestamp` which holds the timestamp of when the alarm was triggered
        */

        return errors;
    }

    applyAsset(store) {
        /* Insert the logic for applyAsset() here */
    }

    undoAsset(store) {
        const errors = [];
        const packet = store.account.get(this.senderId);

        /* --- Revert packet status --- */
        packet.asset.status = null;
        packet.asset.alarms.light.pop();

        store.account.set(packet.address, packet);
        return errors;
    }

}

module.exports = LightAlarmTransaction;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Go to the Lisk Documentation, to get an <a href="../customize.html#_the_basetransaction_interface" class="page">overview about the required methods for custom transactions</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_1_1_1_task_implement_validateasset"><a class="anchor" href="#_1_1_1_task_implement_validateasset"></a>1.1.1 Task: Implement <code>validateAsset()</code></h3>
<div class="paragraph">
<p><strong>Implement your own logic for the <code>validateAsset()</code> function</strong> <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/transactions/light-alarm.js#L31">here at line 31</a>.
The code will validate the timestamp that has been sent by the <code>LightAlarmTransaction</code>.
In case an error is found, push a new <code>TransactionError</code> into the <code>errors</code> array and return it at the end of the function.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
All data, that is sent with the transaction is available through the <code>this</code> variable. So, to access the timestamp of the transaction, use <code>this.timestamp</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The snippet below describes how to create an <code>TransactionError</code> object. Try to add a fitting <code>TransactionError</code> to the <code>errors</code> list of <code>validateAsset()</code>, in case the timestamp is not present, or if it has the wrong format.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The expected data type for the timestamp is <code>number</code>!
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example: How to create a <code>TransactionError</code> object:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">new TransactionError(
	'Invalid "asset.hello" defined on transaction',
	this.id,
	'.asset.hello',
	this.asset.hello,
	'A string value no longer than 64 characters',
)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In case you need some inspiration how to implement the <code>validateAsset()</code> function, check out the other examples like <code>hello_world</code> inside of the <code>lisk-sdk-examples</code> repository, or check the <a href="hello-world.html#_3_create_a_new_transaction_type" class="page">tutorials</a> in the Lisk documentation.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To verify your implementation of <code>validateAsset()</code>, compare it with the <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/transactions/solutions/light-alarm.js">solution</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_2_task_implement_applyasset"><a class="anchor" href="#_1_1_2_task_implement_applyasset"></a>1.1.2 Task: Implement <code>applyAsset()</code></h3>
<div class="paragraph">
<p>The <code>applyAsset</code> function tells the blockchain what changes it should make and how to change a user&#8217;s account. Basically, it holds the core business logic of your custom transaction.
The magic happens here! You can find a possible implementation of <code>applyAsset</code> for the <code>LightAlarmTransaction</code> below.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TASK</dt>
<dd>
<p>Copy the snippet below and replace the <code>applyAsset</code> function in <code>light-alarm.js</code> with it in order to complete the implementation of the lightAlarmTransaction.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">/*Inside of `applyAsset`, we can make use of the cached data from the `prepare` function,
 * which is stored inside of the `store` parameter.*/
applyAsset(store) {
    const errors = [];

    /* With `store.account.get(ADDRESS)` we now get the account data of the packet account.
     * We specify `this.senderId` as address, because the light alarm is always signed and sent by the packet itself. */
    const packet = store.account.get(this.senderId);

    /**
     * Update the Packet account:
     * - set packet status to "alarm"
     * - add current timestamp to light alarms list
     */
    packet.asset.status = 'alarm';
    packet.asset.alarms = packet.asset.alarms ? packet.asset.alarms : {};
    packet.asset.alarms.light = packet.asset.alarms.light ? packet.asset.alarms.light : [];
    packet.asset.alarms.light.push(this.timestamp);

    /* When all changes have been made, they are applied to the database by executing `store.account.set(ADDRESS, DATA)`; */
    store.account.set(packet.address, packet);

    /* Unlike in `validateAsset`, the `store` parameter is present here.
     * That means, inside of `applyAsset` it is possible to make dynamic checks against the existing data in the database.
     *  As we do not need to this here, an empty `errors` array is returned at the end of the function. */
    return errors;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_1_3_register_the_transaction_with_the_application"><a class="anchor" href="#_1_1_3_register_the_transaction_with_the_application"></a>1.1.3 Register the transaction with the application</h3>
<div class="paragraph">
<p>Now, that we have created the new custom transaction type <code>LightAlarmTransaction</code>, it needs to be registered with the node application.
Without this step, the nodes won&#8217;t have the logic to validate a <code>LightAlarmTransaction</code> and the transaction will be discarded.</p>
</div>
<div class="listingblock">
<div class="title">Check out the code at <code>node/index.js</code> which registers the LightAlarmTransaction to the blockchain application:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const { Application, genesisBlockDevnet, configDevnet } = require('lisk-sdk');
const LightAlarmTransaction = require('../transactions/light-alarm');           <i class="conum" data-value="1"></i><b>(1)</b>

configDevnet.app.label = 'lisk-transport';

const app = new Application(genesisBlockDevnet, configDevnet);

app.registerTransaction(LightAlarmTransaction);                                 <i class="conum" data-value="2"></i><b>(2)</b>

app
    .run()
    .then(() =&gt; app.logger.info('App started...'))
    .catch(error =&gt; {
        console.error('Faced error in application', error);
        process.exit(1);
    });</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Requires the custom transaction type.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Registers the custom transaction type with the application.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
After the registration of a new transaction type, the node needs to be restarted to apply the changes with <code>node index.js | npx bunyan -o short</code>.
Make sure you are executing this command inside the <code>node/</code> folder.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_2_the_iot_application"><a class="anchor" href="#_1_2_the_iot_application"></a>1.2 The IoT application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this step we are going to create the script that will run on the Raspberry Pi to track if the packet has been manipulated.</p>
</div>
<div class="sect2">
<h3 id="_1_2_1_connect_to_the_raspberry_pi"><a class="anchor" href="#_1_2_1_connect_to_the_raspberry_pi"></a>1.2.1 Connect to the Raspberry Pi</h3>
<div class="paragraph">
<p>For simplifying the network topology for the workshop we configured a DHCP server in the Raspberry Pi that will assign an IP address to your computer using a virtual ethernet through USB.
The Raspberry Pi will have the hostname <code>raspberrypi.local</code> by default.</p>
</div>
<div class="paragraph">
<p>Connect a micro usb cable with the Raspberry and then connect the other end to a computer.</p>
</div>
<div class="paragraph">
<p><strong>Make sure you connect the micro usb cable to the port that has a small label <code>usb</code> above it.</strong></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/usb-port.jpg" alt="How to connect to your Pi"></span></p>
</div>
<div class="paragraph">
<p>Next, to be able to log in using <code>ssh</code> from a terminal run the below <code>ping</code> command.
This will start pinging the Raspberry Pi and you&#8217;ll eventually get responses back.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ping raspberrypi.local</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example output from pinging the Raspberry Pi:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Request timeout for icmp_seq 79
Request timeout for icmp_seq 80
Request timeout for icmp_seq 81
Request timeout for icmp_seq 82
Request timeout for icmp_seq 83
Request timeout for icmp_seq 84
64 bytes from raspberrypi.local: icmp_seq=85 ttl=64 time=0.952 ms
64 bytes from raspberrypi.local: icmp_seq=86 ttl=64 time=0.677 ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you start to get lines like the last one you can execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh pi@raspberrypi.local</code></pre>
</div>
</div>
<div class="paragraph">
<p>If prompted with a warning just hit enter to accept the default (Yes).</p>
</div>
<div class="paragraph">
<p>Following, it will prompt for a password, <strong>enter the password in the label of the box of your Raspberry.</strong></p>
</div>
<div class="paragraph">
<p>Your terminal should now be connected to the Raspberry Pi.
In the next step, we will be working on the Raspberry Pi in order to prepare the device.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_2_create_the_tracking_script"><a class="anchor" href="#_1_2_2_create_the_tracking_script"></a>1.2.2 Create the tracking script</h3>
<div class="paragraph">
<p>Execute the below commands for creating the tracking script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir light_alarm #Create a folder to hold the tracking script.
cd light_alarm
npm init --yes #Creates the `package.json` file.
npm i @liskhq/lisk-transactions @liskhq/lisk-api-client @liskhq/lisk-constants rpi-pins #Install dependencies.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, create a new file called <code>light-alarm.js</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">touch light-alarm.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, <strong>copy the code from your local computer</strong> at <code>transport/transactions/light-alarm.js</code> (which we prepared in <a href="#_1_1_implement_the_lightalarm_transaction">step 1.1</a>) to the Raspberry Pi.
First, let&#8217;s open the file with the <code>nano</code> editor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">nano light-alarm.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, insert here the code of the <code>LightAlarmTransaction</code>.
You can use <span class="keyseq"><kbd>CMD</kbd>+<kbd>V</kbd></span> to paste the contents in the file.
In order to save and exit <code>nano</code>, use:</p>
</div>
<div class="paragraph">
<p><span class="keyseq"><kbd>CMD</kbd>+<kbd>O</kbd></span></p>
</div>
<div class="paragraph">
<p><kbd>ENTER</kbd></p>
</div>
<div class="paragraph">
<p><span class="keyseq"><kbd>CMD</kbd>+<kbd>X</kbd></span></p>
</div>
<div class="paragraph">
<p>The second file you need to create is the actual tracking script.
Create a new file <code>index.js</code> that will hold our tracking script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">touch index.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, <strong>insert the code snippet below</strong> and save the <code>index.js</code> file.
You can reuse the above commands with the <code>nano</code> editor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const PIN = require("rpi-pins");
const GPIO = new PIN.GPIO();
// Rpi-pins uses the WiringPi pin numbering system (check https://pinout.xyz/pinout/pin16_gpio23).
GPIO.setPin(4, PIN.MODE.INPUT);
const LightAlarmTransaction = require('./light-alarm');
const { APIClient } = require('@liskhq/lisk-api-client');

// Replace `localhost` with the IP of the node you want to reach for API requests.
const api = new APIClient(['http://localhost:4000']);

// Check config file or visit localhost:4000/api/node/constants to verify your epoc time (OK when using /transport/node/index.js)
const dateToLiskEpochTimestamp = date =&gt; (
    Math.floor(new Date(date).getTime() / 1000) - Math.floor(new Date(Date.UTC(2016, 4, 24, 17, 0, 0, 0)).getTime() / 1000)
);

const packetCredentials = { /* Insert the credentials of the packet here in step 1.3 */ }

// Check the status of the sensor in a certain intervall (here: 1 second).
setInterval(() =&gt; {
	let state = GPIO.read(4);
    if(state === 0) {
        console.log('Package has been opened! Send lisk transaction!');

        // Uncomment the below code in step 1.3 of the workshop
        /*
        let tx = new LightAlarmTransaction({
            timestamp: dateToLiskEpochTimestamp(new Date())
        });

        tx.sign(packetCredentials.passphrase);

        api.transactions.broadcast(tx.toJSON()).then(res =&gt; {
            console.log("++++++++++++++++ API Response +++++++++++++++++");
            console.log(res.data);
            console.log("++++++++++++++++ Transaction Payload +++++++++++++++++");
            console.log(tx.stringify());
            console.log("++++++++++++++++ End Script +++++++++++++++++");
        }).catch(err =&gt; {
            console.log(JSON.stringify(err.errors, null, 2));
        });
        */
    } else {
        console.log('Alles gut');
    }
}, 1000);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_2_3_run_the_tracking_script"><a class="anchor" href="#_1_2_3_run_the_tracking_script"></a>1.2.3 Run the tracking script</h3>
<div class="paragraph">
<p>To check if the script can read the sensor data, start the script by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">node index.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now place the sensor in a dark place and then in a light place, and verify the correct logs are shown in the console.</p>
</div>
<div class="paragraph">
<p>If no light is detected, it should log:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Alles gut</code></pre>
</div>
</div>
<div class="paragraph">
<p>and if light is detected, it will log:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Package has been opened! Send lisk transaction!</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code will also try to send the <code>LightAlarmTransaction</code> in case it detects light.
This will fail, as we didn&#8217;t provide the passphrase of the packet in the script, which is needed to sign the <code>LightAlarmTransaction</code>.</p>
</div>
<div class="paragraph">
<p>You can cancel the script for now by stopping its execution with:</p>
</div>
<div class="paragraph">
<p><span class="keyseq"><kbd>CMD</kbd>+<kbd>C</kbd></span></p>
</div>
<div class="paragraph">
<p>Next up, let&#8217;s use the client app in <code>step 1.3</code> to initialize a new account for the packet.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_3_the_client_application"><a class="anchor" href="#_1_3_the_client_application"></a>1.3 The client application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this step, we have to store the passphrase of the packet on the Raspberry Pi so it can sign and broadcast the <code>LightAlarmTransaction</code>.
After that, we will start the <code>client</code> application to explore the sent transactions.</p>
</div>
<div class="paragraph">
<p>While your Raspberry Pi is still connected, open a local terminal window and navigate into the <code>client</code> app.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The complete implementation of the client is prepared for you before the workshop.
In this part 1 of the workshop, we will only make use of the <code>Initialize</code> and <code>Packet&amp;Carrier</code> pages.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_1_3_1_installation"><a class="anchor" href="#_1_3_1_installation"></a>1.3.1 Installation</h3>
<div class="paragraph">
<p>Let&#8217;s start the client application with the following commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ../client
npm i
node app.js</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure your blockchain is running in order for the client to work! If not, start your blockchain by navigating to the <code>node/</code> folder and running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">node index.js | npx bunyan -o short</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_2_create_new_package_credentials"><a class="anchor" href="#_1_3_2_create_new_package_credentials"></a>1.3.2 Create New Package Credentials</h3>
<div class="paragraph">
<p>Navigate to the <code>Initialize</code> page (web app running at <a href="http://localhost:3000" class="bare">http://localhost:3000</a>) to create a new packet account.
Every time that you refresh the page, new packet credentials are created and initialized on the network.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/initialize-step1.png" alt="Initialization of the packet account"></span></p>
</div>
<div class="paragraph">
<p>Copy the object with the credentials and paste it as <code>packetCredentials</code> in your <a href="#_122_create_the_tracking_script">tracking script</a> on the Raspberry Pi.
You have to paste it in the <code>index.js</code> file on the Raspberry Pi at the following line of code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const packetCredentials = { /* Insert the credentials of the packet here in step 1.3 */ }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_3_update_ip_for_node_api"><a class="anchor" href="#_1_3_3_update_ip_for_node_api"></a>1.3.3 Update IP for Node API</h3>
<div class="paragraph">
<p>Exchange <code>localhost</code> with the IP where your node application is running.</p>
</div>
<div class="paragraph">
<p>If you followed the tutorial, your node should run on your local machine.
To get the IP, open a new terminal window on your machine and type <code>ifconfig</code> or a similar command, that displays your current IP address.</p>
</div>
<div class="paragraph">
<p>Simply copy it and replace <code>localhost</code> in the tracking script with it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-js hljs" data-lang="js">const api = new APIClient(['http://localhost:4000']);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ok, we are all set to check all elements together.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_4_uncomment_code_that_sends_the_light_alarm_transaction"><a class="anchor" href="#_1_3_4_uncomment_code_that_sends_the_light_alarm_transaction"></a>1.3.4 Uncomment code that sends the light alarm transaction</h3>
<div class="paragraph">
<p>Now uncomment the <a href="https://github.com/LiskHQ/lisk-sdk-examples/blob/development/transport/iot/light_alarm/index.js#L25">code snippet that creates and sends the light alarm transaction object</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_1_3_5_validating_all_components"><a class="anchor" href="#_1_3_5_validating_all_components"></a>1.3.5 Validating all components</h3>
<div class="paragraph">
<p>To now track the light alarm with the client application, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure your blockchain node is running on your machine (<code>node/</code> folder):</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">node index.js | npx bunyan -o short</code></pre>
</div>
</div>
</li>
<li>
<p>Make sure the client from the <code>client/</code> folder is running:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">node app.js</code></pre>
</div>
</div>
</li>
<li>
<p>Put the sensor of your raspberry in a dark place.</p>
</li>
<li>
<p>Now, start the tracking script on your Raspberry Pi:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">node index.js</code></pre>
</div>
</div>
</li>
<li>
<p>Go to the <code>Packet&amp;Carrier</code> page in the client which is running at localhost:3000 and refresh.
Nothing should be shown on the page, yet.</p>
</li>
<li>
<p>Now, shed some light on the sensor, and refresh the page again.</p>
</li>
<li>
<p>If you refresh again, you should see a list of timestamps at which <code>LightAlarmTransactions</code> have been fired, sent by the Raspberry Pi.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>If you see the timestamps are added to <code>asset.alarms.light</code> of the packet account, you have successfully completed <code>part 1</code> of the workshop, congratz! \o/ </strong></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/packet-carrier-step1.png" alt="packet account"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You are now able to detect a packet manipulation and save the corresponding timestamp on the blockchain.</p>
</div>
<div class="paragraph">
<p><a href="transport2.html" class="page">Click here to continue with part 2: Create a simple supply chain system</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>

</article>
<aside class="article-aside hidden" role="navigation">
    <h3 class="toc-title">On this page:</h3>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="footer__container">
        <div class="footer__copyright">
            <div class="institutional-links-2">
                <span class="institutional-links-2__item">© 2019 Lisk Foundation</span>
                <a class="institutional-links-2__item" href="https://lisk.io/terms-conditions" class="institutional-links-2-item">Terms & Conditions</a>
                <a class="institutional-links-2__item" href="https://lisk.io/privacy" class="institutional-links-2-item">Privacy Policy</a>
            </div>
            <p class="footer__copyright-text">Lisk is a foundation registered in Zug, Zwitserland
            </p>
        </div>
        <div class="footer__logo-container">
            <img src="../_/img/lisk-logo-light.svg" class="footer__lisk-logo"/>
        </div>
        <div class="community-section">
            <p class="community-section__text">Follow Lisk on: </p>
            <div class="community-section__icons">
                <a href="https://github.com/LiskHQ" target="_blank" class="footer__icon icon-github"></a>
                <a href="https://www.youtube.com/channel/UCuqpGfg_bOQ8Ja4pj811PWg/featured" target="_blank" class="footer__icon icon-youtube"></a>
                <a href="https://www.reddit.com/r/Lisk/" target="_blank" class="footer__icon icon-reddit"></a>
                <a href="https://www.linkedin.com/company/lisk/" target="_blank" class="footer__icon icon-linkedin"></a>
                <a href="https://twitter.com/LiskHQ" target="_blank" class="footer__icon icon-twitter"></a>
                <a href="https://www.facebook.com/LiskHQ" target="_blank" class="footer__icon icon-facebook"></a>
            </div>
        </div>
    </div>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.10.0/tocbot.min.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script async src="../../_/js/vendor/tabs-block-behaviour.js"></script>
<script>
    tocbot.init( {
        tocSelector: '#article-toc',
        contentSelector: 'article',
        headingSelector: 'h1, h2, h3',
        collapseDepth: 6,
        positionFixedSelector: null,
        scrollSmooth: false
    } );
    var tocList = document.getElementById( 'article-toc' ).getElementsByClassName( 'toc-list' );
    if ( tocList && tocList.length > 0 && tocList[0].childNodes.length > 0 ) {
        document.getElementById( 'article-toc' ).parentNode.classList.remove( 'hidden' );
    }
</script>
  </body>
</html>
